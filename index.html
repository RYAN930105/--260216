<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±ªè¯æ‹‰éœ¸æ©Ÿ - éŸ³æ•ˆå¢å¼·ç‰ˆ</title>
    <style>
        /* CSS ä¿æŒä¸è®Šï¼Œå»¶ç”¨æ‚¨çš„ç²¾ç¾æ¨£å¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            margin: 0;
            overflow: hidden;
        }
        .slot-machine-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
            border: 4px solid #ffcc00;
        }
        h1 { color: #ffcc00; margin-bottom: 10px; text-shadow: 0 0 10px rgba(255, 204, 0, 0.7); }
        .balance-box { background: #222; padding: 10px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #444; }
        .balance { font-size: 1.8em; color: #00ffcc; }
        .reel-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; }
        .slot { width: 100px; height: 120px; background: white; border-radius: 10px; overflow: hidden; position: relative; box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.5); border: 3px solid #ffcc00; }
        .reel-list { list-style: none; padding: 0; margin: 0; position: absolute; top: 0; left: 0; width: 100%; }
        .reel-list li { height: 120px; display: flex; align-items: center; justify-content: center; font-size: 60px; background: white; color: #333; border-bottom: 1px solid #eee; }
        .spin-button { background: linear-gradient(to bottom, #ff416c, #ff4b2b); color: white; border: none; padding: 15px 40px; font-size: 1.5em; font-weight: bold; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 0 #990000; transition: all 0.1s; }
        .spin-button:active { transform: translateY(3px); box-shadow: 0 2px 0 #990000; }
        .spin-button:disabled { background: #555; box-shadow: 0 5px 0 #333; cursor: not-allowed; }
        .bet-input { width: 100px; padding: 10px; font-size: 1.2em; border-radius: 5px; text-align: center; margin-bottom: 20px; border: 2px solid #ffcc00; background: #333; color: white; }
        .result { margin-top: 20px; font-size: 1.5em; min-height: 1.5em; color: #ffcc00; }
        .rules-note { font-size: 0.8em; color: #aaa; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="slot-machine-container">
        <h1>ğŸ’° è±ªè¯æ‹‰éœ¸æ©Ÿ ğŸ’°</h1>
        
        <div class="balance-box">
            <div class="balance">ğŸ’° $<span id="balance">10000</span></div>
            <div style="font-size: 0.8em; color: #888;">(æ¯æ—¥ç™»å…¥è‡ªå‹•ç™¼æ”¾ $10,000)</div>
        </div>

        <div class="reel-container">
            <div class="slot" id="slot1"><ul class="reel-list"></ul></div>
            <div class="slot" id="slot2"><ul class="reel-list"></ul></div>
            <div class="slot" id="slot3"><ul class="reel-list"></ul></div>
        </div>

        <div>
            <label>ä¸‹æ³¨é¡ (ä¸Šé™ 1000): </label><br>
            <input type="number" id="betAmount" class="bet-input" value="100" min="1" max="1000">
            <br>
            <button class="spin-button" onclick="spin()">ğŸ° é–‹å§‹æ—‹è½‰</button>
        </div>
        
        <p class="result" id="result">ç¥ä½ å¥½é‹ï¼</p>

        <div class="rules-note">
            â€» ç²çé‚è¼¯ï¼šä¸‰é€£ç·šä¾å€ç‡è¨ˆç®— | å‰äºŒåŒ x2 | ä»»äºŒåŒ x1.5
        </div>
    </div>

    <script>
        // --- åˆå§‹åŒ–åƒæ•¸ ---
        const SYMBOLS_RAW = ['ğŸ’', 'ğŸ‹', 'ğŸ””', 'ğŸ’', '7ï¸âƒ£'];
        const SYMBOLS_WEIGHTED = ['ğŸ’','ğŸ’','ğŸ’','ğŸ’','ğŸ’','ğŸ‹','ğŸ‹','ğŸ‹','ğŸ‹','ğŸ””','ğŸ””','ğŸ””','ğŸ’','ğŸ’','7ï¸âƒ£'];
        const WIN_MULTIPLIER = { 'ğŸ’': 5, 'ğŸ‹': 10, 'ğŸ””': 20, 'ğŸ’': 50, '7ï¸âƒ£': 100 };

        let balance = parseInt(localStorage.getItem('slot_balance')) || 10000;
        let isSpinning = false;

        // --- éŸ³æ•ˆç‰©ä»¶è¨­å®š ---
        // æç¤ºï¼šå¦‚æœä½ æœ‰å¯¦é«”æª”æ¡ˆï¼Œè«‹å°‡ä¸‹æ–¹ç¶²å€æ›æˆ 'spin.mp3' ç­‰æª”å
        const sounds = {
            spin: new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3'),
            win: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'),
            lose: new Audio('https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3')
        };

        // é è¼‰éŸ³æ•ˆ
        Object.values(sounds).forEach(s => s.load());

        // --- æ ¸å¿ƒé‚è¼¯ ---
        function checkDailyBonus() {
            const lastDate = localStorage.getItem('last_login_date');
            const today = new Date().toDateString();
            if (lastDate !== today) {
                balance += 10000;
                localStorage.setItem('last_login_date', today);
                updateBalanceDisplay(0);
                alert("ğŸ æ¯æ—¥ç™»å…¥çå‹µï¼å·²è´ˆé€ $10,000ï¼");
            }
        }

        function updateBalanceDisplay(amount = 0) {
            balance += amount;
            document.getElementById('balance').innerText = balance.toLocaleString();
            localStorage.setItem('slot_balance', balance);
        }

        function createReelList(reelId) {
            const ul = document.querySelector(`#${reelId} .reel-list`);
            ul.innerHTML = '';
            for (let i = 0; i < 30; i++) {
                const li = document.createElement('li');
                li.innerText = SYMBOLS_RAW[Math.floor(Math.random() * SYMBOLS_RAW.length)];
                ul.appendChild(li);
            }
        }

        function spin() {
            if (isSpinning) return;

            const betInput = document.getElementById('betAmount');
            let bet = parseInt(betInput.value);

            if (isNaN(bet) || bet <= 0) { alert("è«‹è¼¸å…¥æœ‰æ•ˆé‡‘é¡"); return; }
            if (bet > 1000) { bet = 1000; betInput.value = 1000; }
            if (bet > balance) { alert("é¤˜é¡ä¸è¶³"); return; }

            // å•Ÿå‹•æ—‹è½‰
            isSpinning = true;
            document.querySelector('.spin-button').disabled = true;
            updateBalanceDisplay(-bet);
            document.getElementById('result').innerText = "âš¡ æ—‹è½‰ä¸­... âš¡";
            document.getElementById('result').style.color = "#ffcc00";

            // æ’­æ”¾æ—‹è½‰éŸ³æ•ˆ
            sounds.spin.currentTime = 0;
            sounds.spin.play().catch(e => console.warn("éŸ³æ•ˆæ’­æ”¾å—é™"));

            const finalSymbols = [];
            const spinPromises = [];

            for (let i = 1; i <= 3; i++) {
                const reel = document.querySelector(`#slot${i} .reel-list`);
                const targetSymbol = SYMBOLS_WEIGHTED[Math.floor(Math.random() * SYMBOLS_WEIGHTED.length)];
                finalSymbols.push(targetSymbol);

                const li = document.createElement('li');
                li.innerText = targetSymbol;
                reel.appendChild(li);

                const duration = 2000 + (i * 500);
                const offset = (reel.children.length - 1) * 120;

                reel.style.transition = `transform ${duration}ms cubic-bezier(0.1, 0, 0.1, 1)`;
                reel.style.transform = `translateY(-${offset}px)`;

                spinPromises.push(new Promise(res => setTimeout(res, duration)));
            }

            Promise.all(spinPromises).then(() => {
                isSpinning = false;
                document.querySelector('.spin-button').disabled = false;
                sounds.spin.pause(); // åœæ­¢æ—‹è½‰éŸ³
                checkWin(finalSymbols, bet);
                
                // å»¶é²é‡ç½®è½‰ç›¤ä½ç½®ï¼Œè®“ä½¿ç”¨è€…çœ‹æ¸…æ¥šçµæœ
                setTimeout(() => {
                    for (let i = 1; i <= 3; i++) {
                        const reel = document.querySelector(`#slot${i} .reel-list`);
                        reel.style.transition = 'none';
                        reel.style.transform = 'translateY(0)';
                        createReelList(`slot${i}`);
                    }
                }, 1000);
            });
        }

        function checkWin(symbols, bet) {
            const [s1, s2, s3] = symbols;
            let win = 0;
            let msg = "éŠ˜è¬æƒ é¡§ ğŸ˜¢";

            // ç²çé‚è¼¯
            if (s1 === s2 && s2 === s3) {
                win = bet * WIN_MULTIPLIER[s1];
                msg = `ğŸŠ é©šäººå¤§çï¼${s1}${s1}${s1} è´å¾— $${win}ï¼`;
            } else if (s1 === s2 || s1 === s3 || s2 === s3) {
                win = Math.floor(bet * (s1 === s2 ? 2 : 1.5));
                msg = `âœ¨ æ­å–œä¸­çï¼è´å¾— $${win}ï¼`;
            }

            if (win > 0) {
                updateBalanceDisplay(win);
                document.getElementById('result').innerText = msg;
                document.getElementById('result').style.color = "#00ffcc";
                sounds.win.currentTime = 0;
                sounds.win.play();
            } else {
                document.getElementById('result').innerText = msg;
                document.getElementById('result').style.color = "#aaa";
                sounds.lose.currentTime = 0;
                sounds.lose.play();
            }
        }

        // å•Ÿå‹•åˆå§‹åŒ–
        checkDailyBonus();
        for (let i = 1; i <= 3; i++) createReelList(`slot${i}`);
        updateBalanceDisplay(0);
    </script>
</body>
</html>